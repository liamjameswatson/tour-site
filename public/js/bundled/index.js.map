{"mappings":"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","sources":["public/js/mapbox.js","public/js/alerts.js","public/js/login.js","public/js/updateSettings.js","public/js/stripe.js","public/js/index.js"],"sourcesContent":["export const displayMap = (locations) => {\r\n  mapboxgl.accessToken =\r\n    'pk.eyJ1IjoibGlhbWp3YXN0b24iLCJhIjoiY2xocnE5dmJvMHR0ODNqbzg1eDlwMmZ4MyJ9.tKOeD3S8ZqLJMwU0aa75Jg';\r\n  var map = new mapboxgl.Map({\r\n    container: 'map',\r\n    style: 'mapbox://styles/liamjwaston/clhs1oqry01zl01png17g3nyx',\r\n    scrollZoom: false,\r\n    // center: [-0.47853, 51.748834],\r\n    // zoom: 15,\r\n    // interactive: false,\r\n  });\r\n\r\n  const bounds = new mapboxgl.LngLatBounds(); //area displayed on map\r\n\r\n  locations.forEach((location) => {\r\n    // Create marker for map\r\n    const el = document.createElement('div');\r\n    el.className = 'marker';\r\n\r\n    // Add the marker\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      anchor: 'bottom',\r\n    })\r\n      .setLngLat(location.coordinates)\r\n      .addTo(map);\r\n\r\n    // Add popup\r\n    new mapboxgl.Popup({\r\n      offset: 30,\r\n    })\r\n\r\n      .setLngLat(location.coordinates)\r\n      .setHTML(`<p>Day ${location.day}: ${location.description}</p>`)\r\n      .addTo(map);\r\n\r\n    // Extend map bounds to include the current location\r\n    bounds.extend(location.coordinates);\r\n  });\r\n\r\n  // fit map to bounds object\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 100,\r\n      left: 100,\r\n      right: 100,\r\n    },\r\n  });\r\n};\r\n","export const hideAlert = () => {\r\n  // select element with alert class and remove it\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n// create a html div element with a class of alert, and either 'success' or 'error and put in the message\r\n//type is 'success' or 'error\r\nexport const showAlert = (type, message, time = 7) => {\r\n  hideAlert(); // do this before showing a new alert.\r\n  const markup = `<div class=\"alert alert--${type}\">${message}</div>`;\r\n  // insert this div inside the body element, at the beginning\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, time * 1000); // hides alert after 5 seconds\r\n};\r\n","import '@babel/polyfill';\r\nimport axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'POST',\r\n      url: '/api/v1/users/login',\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n      withCredentials: true,\r\n    });\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 700);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logOut = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n    });\r\n    // if success reload the page, to clear the cookie\r\n    if (res.data.status === 'success') {\r\n      // location.reload(true);\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 700);\r\n    }\r\n  } catch (err) {\r\n    // might be error if no internet connection\r\n    showAlert('error', 'Error loggin out. Please try again.');\r\n  }\r\n};\r\n","// Create an updateData func\r\nimport axios from 'axios';\r\nimport { showAlert } from './alerts.js';\r\n// call the func from index.js        //similar to login\r\n\r\n//type is either 'password' or 'data\r\nexport const updateSettings = async (data, type) => {\r\n  try {\r\n    const url =\r\n      type === 'password'\r\n        ? '/api/v1/users/updateMyPassword'\r\n        : '/api/v1/users/updateMe';\r\n\r\n    const res = await axios({\r\n      method: 'PATCH',\r\n      url,\r\n      data,\r\n    });\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', `${type.toUpperCase()} updated successfully!`);\r\n      window.setTimeout(() => {\r\n        location.reload();\r\n      }, 700);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","/* eslint-disable */\r\nimport axios from 'axios';\r\nimport Stripe from 'stripe';\r\nimport { showAlert } from './alerts';\r\nconst stripe = Stripe(\r\n  'pk_test_51NCk7XHsEhTZcNCRwFCQsqbJ9QLcmrw2b0iOAB8sDOXAsWoeUrvua9Sqra3g5lK2NmOaxpQEaxP1XV8DCyAgfHeO00nT8ec2Jv'\r\n);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    //1) Get checkout session from API endpoint\r\n\r\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\r\n    console.log(session);\r\n    //2) open the stripe checkout page (provided by the session.url)\r\n    window.location.assign(session.data.session.url);\r\n  } catch (err) {\r\n    console.log(err);\r\n    showAlert('error', err);\r\n  }\r\n};\r\n","import { displayMap } from './mapbox.js';\r\nimport { logOut, login } from './login.js';\r\nimport { updateSettings } from './updateSettings.js';\r\nimport { bookTour } from './stripe.js';\r\nimport { showAlert } from './alerts.js';\r\n//DOM Elements\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\n//VALUES\r\n\r\n//DELEGATION\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  document.querySelector('.form').addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    login(email, password);\r\n  });\r\n}\r\n\r\n// if logout button listen for a click, call the logout function\r\nif (logOutBtn) {\r\n  logOutBtn.addEventListener('click', logOut);\r\n}\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n    // console.log(form);\r\n\r\n    updateSettings(form, 'data');\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n\r\n    const passwordCurrent = document.getElementById('password-current').value;\r\n    const password = document.getElementById('password').value;\r\n    const passwordConfirm = document.getElementById('password-confirm').value;\r\n    const email = document.getElementById('email').value;\r\n    await updateSettings(\r\n      { passwordCurrent, password, passwordConfirm },\r\n      'password'\r\n    );\r\n\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n    document.querySelector('.btn--save-password').textContent = 'Save password';\r\n  });\r\n}\r\n\r\nif (bookBtn)\r\n  bookBtn.addEventListener('click', (e) => {\r\n    e.target.textContent = 'Processing...';\r\n    const { tourId } = e.target.dataset; //the button id\r\n    bookTour(tourId);\r\n  });\r\n\r\nconst alertMessage = document.querySelector('body').dataset.alert;\r\nif (alertMessage) showAlert('success', alertMessage, 20);\r\n"],"names":["$3e77dce7c3ccaa61$export$4c5dd147b21b9176","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","location","el","document","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$46cfd0d59975cb77$export$516836c6a9dfc573","querySelector","parentElement","removeChild","$46cfd0d59975cb77$export$de026b00723010c1","type","message","time","markup","insertAdjacentHTML","window","setTimeout","$4d647cd5be70417b$export$596d806903d1f59e","async","email","password","$parcel$interopDefault","$4Fc6t$axios","method","url","data","withCredentials","status","assign","err","response","$4b7172a7c96e3ffe$export$f558026a994b6051","toUpperCase","reload","$b6c6f2a7f2aa989e$export$8d5bdbf26681c0c2","$4Fc6t$stripe","tourId","session","console","log","$73dd935dd99c81ee$var$mapBox","getElementById","$73dd935dd99c81ee$var$loginForm","$73dd935dd99c81ee$var$logOutBtn","$73dd935dd99c81ee$var$userDataForm","$73dd935dd99c81ee$var$userPasswordForm","$73dd935dd99c81ee$var$bookBtn","JSON","parse","dataset","addEventListener","e","preventDefault","value","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target","$73dd935dd99c81ee$var$alertMessage","alert"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}